import streamlit as st
import pandas as pd

def get_gmap_link(query, mode="transit"):
    # mode: driving (開車), walking (走路), transit (大眾運輸)
    base_url = "https://www.google.com/maps/dir/?api=1"
    return f"{base_url}&destination={query}&travelmode={mode}"

def show_food_table(region):
    """
    顯示美食店家的表格，包含導航連結。
    Args:
        region (str): 地區名稱，例如 "金澤", "飛驒高山", "榮商圈"
    """
    
    # ==========================================
    # 1. 在這裡編輯您的店家資料 (完全保留您的內容)
    # ==========================================
    data_source = {
        "金澤": [
            {"店名": "烏雞庵 金澤東山店", "時間": "09:30-17:30", "備註": "蜂蜜蛋糕(伴手禮)"},
            {"店名": "箔一 東山店", "時間": "09:00-18:00", "備註": "金箔冰淇淋"},
            {"店名": "Shogun Burger Kanazawa", "時間": "11:00-21:30", "備註": "和牛漢堡"},
            {"店名": "能登前寿司(金沢駅)", "時間": "11:00-21:30", "備註": "迴轉壽司"},
            {"店名": "關東煮 黑百合", "時間": "11:00-22:00", "備註": "金澤車站1F(百番街)"},
            {"店名": "麵屋大河", "時間": "11:30–14:30、17:30–22:30", "備註": "4.4星(3,208)"},
            {"店名": "McDonald's", "時間": "07:00-22:00", "備註": "金澤車站1F(百番街)"},
            {"店名": "Go Go Curry", "時間": "10:00-20:00", "備註": "金澤車站1F(百番街)"},
        ],
        "飛驒高山": [
            {"店名": "丸明燒肉", "時間": "11:00-21:00", "備註": "16:30發號碼"},
            {"店名": "吉田製麵所", "時間": "11:00-14:00", "備註": "週一公休"},
            {"店名": "Train Bleu", "時間": "10:00-16:30", "備註": "麵包店(週三公休)"},
            {"店名": "甚五郎拉麵 本店", "時間": "10:30-15:00 / 20:00-02:00", "備註": "宵夜備案 (飯店旁)"},
            {"店名": "駿河屋 Asumo店", "時間": "10:00-21:00", "備註": "當地超市 (水果/和牛)"},
            {"店名": "Suzuya Restaurant", "時間": "11:00-14:00 / 17:00-20:00", "備註": "家庭式餐廳 (週二休)"},
            {"店名": "麵屋白川", "時間": "11:00-15:00", "備註": "米其林推薦 (週二休)"},
            {"店名": "高山布丁亭", "時間": "10:00-16:30", "備註": "甜點/布丁"},
            {"店名": "飛驒 特牛 (こって牛)", "時間": "10:00-17:00", "備註": "飛驒牛壽司+仙貝盤"},
            {"店名": "飛驒中華拉麵 M", "時間": "11:00-14:30 / 17:30-20:00", "備註": "Google 4.7星"},
            {"店名": "Kyoshi 梗絲", "時間": "10:00–15:00 / 17:00–19:00", "備註": "和牛定食 (週二開半天)"},
            {"店名": "Miyabi-an Soba (雅)", "時間": "11:00–14:45 / 18:00–21:00", "備註": "蕎麥麵(週一休)"},
            {"店名": "惠比壽手打蕎麥麵", "時間": "11:00–15:00", "備註": "手打蕎麥麵(週二休)"},
        ],
        "榮商圈": [
            {"店名": "一蘭 名古屋榮店", "時間": "24hr", "備註": "榮站附近"},
            {"店名": "熱田蓬萊軒 (松坂屋店)", "時間": "11:00–14:30\n16:30–20:30", "備註": "16:30發號碼牌(南館10F)"},
            {"店名": "馬喰一代 名古屋榮", "時間": "11:30-23:00", "備註": "已預約 1/22 (四) 11:30,燒肉"},
            {"店名": "世界的山將 本店", "時間": "16:00-23:15", "備註": "週五晚餐,夢幻手羽先(雞翅)、炒飯"},
            {"店名": "名古屋味噌豬排 黑豚屋", "時間": "11:00–15:00\n17:30–22:00", "備註": "週六午餐, ⚠️僅收現金 (B1)"},
            {"店名": "Konparu Osu (大須本店)", "時間": "08:00-19:00", "備註": "炸蝦三明治"},
            {"店名": "SKYLE 購物中心", "時間": "10:00-20:00", "備註": "3COINS, GU, UNIQLO, 大創, 扭蛋機"},
            {"店名": "RAYARD 久屋大通公園 & Oasis 21", "時間": "晚上點燈", "備註": "Snow Peak Eat, 吉卜力商店"},
            {"店名": "HARBS 名古屋 LACHIC店", "時間": "11:00–21:00", "備註": "2F"},
            {"店名": "麥當勞 SUNSHINE榮店", "時間": "07:00-00:00", "備註": "早餐備案"},
            {"店名": "Menya Kiyo (麵屋 聖)", "時間": "11:00–14:30\n17:30–22:00", "備註": "拉麵"},
            {"店名": "麥當勞 榮大津通店", "時間": "24hr", "備註": "最後一天早餐"},
        ]
    }

    # ==========================================
    # 2. 處理資料與顯示 logic
    # ==========================================
    
    # 檢查地區是否存在
    if region not in data_source:
        st.warning(f"⚠️ 找不到 '{region}' 的資料，請檢查名稱是否正確。")
        return

    # 建立 DataFrame
    df = pd.DataFrame(data_source[region])

    # 內部使用的導航產生器 (使用標準 Google Maps 搜尋)
    def make_link(name):
        return f"https://www.google.com/maps/search/?api=1&query={name}"
    
    # 新增導航欄位
    df["導航"] = df["店名"].apply(make_link)
    
    # 重新排列欄位順序
    df = df[["店名", "導航", "時間", "備註"]]

    # 計算表格高度 (讓它自動長高，不用卷軸)
    # 標題列(約35px) + 每一列(約35px) + 緩衝(3px)
    # 有些內容會換行，所以稍微增加高度係數
    table_height = (len(df) + 1) * 38 + 3

    # 顯示摺疊表格
    with st.expander(f"🍽️ 點我看：{region} 美食店家清單", expanded=False):
        st.data_editor(
            df,
            column_config={
                "店名": st.column_config.TextColumn("店名", width="medium"),
                "導航": st.column_config.LinkColumn(
                    "導航",
                    display_text="📍 導航", 
                    help="點擊前往 Google Maps",
                    validate="^https://.*",
                    width="small"
                ),
                "時間": st.column_config.TextColumn("時間", width="medium"),
                "備註": st.column_config.TextColumn("備註", width="large"),
            },
            hide_index=True,
            disabled=True,
            use_container_width=True,
            height=table_height # 自動調整高度
        )
